<div class="notifications-container" appInfiniteScroll (scrolled)="onScroll()">
  <!-- Header -->
  <app-navbar></app-navbar>

  <!-- Notifications Content -->
  <div class="notifications-content">
    <div class="header-actions">
      <div class="notification-left">
        <mat-icon>notifications</mat-icon>
        <h1>Notifications</h1>
      </div>
      <button mat-icon-button [matMenuTriggerFor]="notificationMenu">
        <mat-icon>more_vert</mat-icon>
      </button>

      <mat-menu #notificationMenu="matMenu">
        <button mat-menu-item (click)="markAllAsRead()" [disabled]="unreadCount() === 0">
          <mat-icon>done_all</mat-icon>
          <span>Mark all read</span>
        </button>
        <button mat-menu-item (click)="clearAll()" [disabled]="notifications().length === 0">
          <mat-icon>clear_all</mat-icon>
          <span>Delete All</span>
        </button>
      </mat-menu>
    </div>
    <div class="notifications-list">
      @for (notification of notifications(); track notification.id) {
      <div
        class="notification-item"
        [class.unread]="!notification.isRead"
        (click)="handleNotificationClick(notification, $event)"
      >
        <div class="notification-icon" [class]="'icon-' + notification.type">
          @switch (notification.type) { @case (NotificationType.LIKE) {
          <mat-icon>favorite</mat-icon>
          } @case (NotificationType.COMMENT) {
          <mat-icon>comment</mat-icon>
          } @case (NotificationType.FOLLOW) {
          <mat-icon>person_add</mat-icon>
          } @default {
          <mat-icon>article</mat-icon>
          } }
        </div>

        <div class="notification-content">
          <div class="notification-header">
            <h4 class="notification-title">{{ notification.title }}</h4>
            <span class="notification-time">{{ notification.createdAt | timeAgo }}</span>
          </div>
          <p class="notification-message">{{ notification.message }}</p>
        </div>

        <div class="notification-actions">
          @if(!notification.isRead){
          <button mat-icon-button (click)="markAsRead(notification, $event)">
            <mat-icon>done</mat-icon>
          </button>
          }
          <button mat-icon-button (click)="deleteNotification(notification, $event)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
      } @if(notifications().length === 0){
      <div class="empty-state">
        <mat-icon>notifications_none</mat-icon>
        <h3>No notifications yet</h3>
        <p>When you get notifications, they'll show up here</p>
      </div>
      } @if(loading()){
      <div class="loading-spinner">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      }
    </div>
  </div>
</div>
