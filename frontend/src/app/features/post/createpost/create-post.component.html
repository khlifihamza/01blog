<div class="create-post-dialog">
  <mat-dialog-content>
    <form [formGroup]="postForm" class="post-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Post Title</mat-label>
        <input matInput formControlName="title" placeholder="What's your post about?" />
        @if(postForm.get('title')?.hasError('required')){
        <mat-error> Title is required </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Content</mat-label>
        <textarea
          matInput
          formControlName="content"
          rows="6"
          placeholder="Share your thoughts, experiences, or what you've learned..."
        ></textarea>
        @if(postForm.get('content')?.hasError('required')){
        <mat-error> Content is required </mat-error>
        }
      </mat-form-field>

      <div>
        <div class="section-label">Images/videos gallery</div>
        <mat-card appearance="outlined" class="card-padding">
          <div class="gallery-layout">
            <!-- Upload Zone -->
            <div class="upload-zone">
              <div class="upload-dropzone" appDndUpload (filesDropped)="onFilesDropped($event)">
                <div class="upload-icon material-icons">folder</div>
                <p class="upload-text">Drop image/video here, paste or</p>
                <input
                  #fileInput
                  hidden
                  type="file"
                  multiple
                  accept="image/*,video/*"
                  (change)="onFileSelected($event)"
                />
                <button mat-stroked-button (click)="fileInput.click()">
                  <mat-icon>add</mat-icon><span>Select</span>
                </button>
              </div>
            </div>

            <!-- Gallery Grid -->
            <div class="gallery">
              <div class="images-grid">
                @for (item of mediaFiles(); track $index) {
                <mat-card class="square card-item">
                  <button
                    mat-icon-button
                    class="delete-btn"
                    (click)="deleteMedia($index)"
                    aria-label="Delete"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                  @if (item.type === 'image') {
                  <img [src]="item.preview" alt="preview" />
                  } @else {
                  <video [src]="item.preview" controls></video>
                  }
                </mat-card>
                }
              </div>
            </div>
          </div>
        </mat-card>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="postForm.invalid || loading"
    >
      @if(loading){
      <mat-spinner diameter="20"></mat-spinner>
      } @if(!loading){
      <span>{{ isEditing ? 'Update' : 'Post' }}</span>
      }
    </button>
  </mat-dialog-actions>
</div>
